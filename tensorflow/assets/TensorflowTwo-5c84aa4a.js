import{d as j,f as T,g as O,h as q,c as i,i as n,F as D,r as y,j as G,o as l,k as W,v as J,t as B,n as $}from"./index-761e0eed.js";import{u as K}from"./useVideo-1d9327e0.js";import{l as Q,t as I,f as S,i as z,z as X,s as Y,a as Z,o as ee,b as te,_ as ae}from"./register_all_kernels-44fb38c1.js";import{S as oe,D as ne}from"./register_all_kernels-645548d3.js";/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function se(h){return new oe(h)}/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */function M(h){return new ne(h)}const ie={class:"tensorflow"},le={class:"tensorflow_modelData_box"},de={class:"tensorflow_modelData_header"},re=["onUpdate:modelValue"],ce=["onClick"],ue={class:"tensorflow_modelData_body"},_e={class:"tensorflow_modelData_body__left"},he={key:0,class:"tensorflow_modelData_body__left_box"},fe=["onClick"],me={class:"tensorflow_modelData_body__right"},ve=["src"],pe={class:"tensorflow_drill"},ge={key:1},we={key:2},Te={class:"tensorflow_detection"},De={style:{width:"100px",height:"20px"}},ye=j({__name:"TensorflowTwo",setup(h){const _=T(-1),f=T(),t=O({width:260,height:260,addStatus:!1,MOBILE_NET_INPUT_HEIGHT:224,MOBILE_NET_INPUT_WIDTH:224,trainingDataInputs:[],trainingDataOutputs:[],isEnd:!1,isDrill:!1}),m=O({name:[],data:[]});function U(){_.value=-1,b()}function E(){if(x.status){if(_.value===-1){const e=f.value;e.width=t.width,e.height=t.height;const d=e.getContext("2d");d.drawImage(k.value,0,0,t.width,t.height),I(function(){const a=S(d.getImageData(0,0,t.width,t.height)).div(255),o=z.resizeBilinear(a,[t.MOBILE_NET_INPUT_HEIGHT,t.MOBILE_NET_INPUT_WIDTH],!0);let r=v.predict(o.expandDims()),u=c.predict(r).squeeze(),H=u.argMax().arraySync(),p=u.arraySync();console.log(u),console.log(H),console.log(p),console.log("================="),m.data=p})}else{const e=f.value[0];e.width=t.width,e.height=t.height;const d=e.getContext("2d");if(d.drawImage(k.value,0,0,t.width,t.height),t.addStatus){s.value[_.value].data.push({base:e.toDataURL("image/png"),imageData:d.getImageData(0,0,t.width,t.height)});let a=!0;s.value.map(o=>{o.data.length||(a=!1)}),t.isDrill=a}}window.requestAnimationFrame(E)}}function F(e){t.addStatus=!0,document.onmouseup=function(){t.addStatus=!1,document.onmouseup=null}}const{newVideoRef:k,videoButtonClick:b,videoConfig:x}=K({width:t.width,height:t.height,videoProceed:E}),L={name:"模型",data:[]},s=T([]);function P(e){s.value=s.value.filter((d,a)=>a!==e)}function N(){const e=JSON.parse(JSON.stringify(L));e.name=e.name+(s.value.length+1),s.value.push(e)}for(let e=0;e<2;e++)N();function C(e){_.value=e,x.status||b()}let v;q(async()=>{v=await Q("./tfjs-model_imagenet_mobilenet_v3_small_100_224_feature_vector_5_default_1",{fromTFHub:!0}),I(function(){v.predict(X([1,t.MOBILE_NET_INPUT_HEIGHT,t.MOBILE_NET_INPUT_WIDTH,3]))})});let c;const g=[],w=[];async function V(){Y(g,w);let e=Z(w,"int32"),d=ee(e,s.value.length),a=te(g);await c.fit(a,d,{shuffle:!0,batchSize:5,epochs:10,callbacks:{onEpochEnd:(o,r)=>{console.log("Data for epoch "+o,r)}}}),e.dispose(),d.dispose(),a.dispose(),t.isDrill=!1,t.isEnd=!0,m.name=s.value.map(o=>o.name),C(-1)}function R(){for(let e=0;e<s.value.length;e++){const{name:d,data:a}=s.value[e];for(let o=0;o<a.length;o++){const r=I(function(){let u=S(a[o].imageData),p=z.resizeBilinear(u,[t.MOBILE_NET_INPUT_HEIGHT,t.MOBILE_NET_INPUT_WIDTH],!0).div(255);return v.predict(p.expandDims()).squeeze()});g.push(r),w.push(e)}}V()}function A(){t.isEnd=!1,c=se(),c.add(M({inputShape:[1024],units:128,activation:"relu"})),c.add(M({units:s.value.length,activation:"softmax"})),c.summary(),c.compile({optimizer:"adam",loss:s.value.length===2?"binaryCrossentropy":"categoricalCrossentropy",metrics:["accuracy"]}),R()}return(e,d)=>(l(),i("div",ie,[n("div",le,[(l(!0),i(D,null,y(s.value,(a,o)=>(l(),i("div",{key:o,class:"tensorflow_modelData"},[n("div",de,[W(n("input",{type:"text","onUpdate:modelValue":r=>a.name=r},null,8,re),[[J,a.name]]),n("span",{onClick:r=>P(o)},"x",8,ce)]),n("div",ue,[n("div",_e,[o===_.value?(l(),i("div",he,[n("canvas",{ref_for:!0,ref_key:"canvasRef",ref:f},null,512),n("span",{onClick:U},"x"),n("div",{onMousedown:F}," 按住录制 ",32)])):(l(),i("button",{key:1,onClick:r=>C(o)},"开启摄像头",8,fe))]),n("div",me,[n("h3",null,B(a.data.length),1),n("div",null,[(l(!0),i(D,null,y(a.data,(r,u)=>(l(),i("img",{key:u,src:r.base},null,8,ve))),128))])])])]))),128)),n("button",{onClick:N},"添加模型")]),n("div",pe,[t.isDrill?(l(),i("button",{key:0,onClick:A},"训练模型")):t.isEnd?(l(),i("button",ge,"已训练模型")):(l(),i("button",we,"请添加数据"))]),n("div",Te,[_.value===-1?(l(),i("canvas",{key:0,width:"260px",height:"260px",ref_key:"canvasRef",ref:f},null,512)):G("",!0),(l(!0),i(D,null,y(m.name,(a,o)=>(l(),i("div",{key:o},[n("span",null,B(a),1),n("div",De,[n("div",{style:$({background:"red",width:(m.data[o]||0)*100+"%",height:"20px"})},null,4)])]))),128))])]))}});const xe=ae(ye,[["__scopeId","data-v-ac65ea80"]]);export{xe as default};
